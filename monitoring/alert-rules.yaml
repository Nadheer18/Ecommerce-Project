prometheus:
  additionalRules:
    - name: custom-alerts
      groups:
        - name: node-alerts
          rules:
            # Node Down Alert
            - alert: NodeDown
              expr: up{job="kubelet"} == 0
              for: 2m
              labels:
                severity: critical
              annotations:
                description: "Node {{ $labels.node }} is down."
                summary: "Node down alert"

        - name: cpu-alerts
          rules:
            # High CPU Node
            - alert: HighNodeCPU
              expr: instance:node_cpu_utilisation:ratio * 100 > 80
              for: 5m
              labels:
                severity: warning
              annotations:
                summary: "High CPU Usage on Node"
                description: "Node {{ $labels.node }} CPU > 80%"

        - name: pod-alerts
          rules:
            # Pod Restart Alert
            - alert: PodRestarting
              expr: increase(kube_pod_container_status_restarts_total[5m]) > 3
              for: 1m
              labels:
                severity: warning
              annotations:
                summary: "Pod is restarting too much"
                description: "Pod {{ $labels.pod }} is restarting frequently."

            # Pod High CPU Alert
            - alert: PodHighCPU
              expr: sum(rate(container_cpu_usage_seconds_total{image!=""}[5m])) by (pod) > 0.5
              for: 3m
              labels:
                severity: warning
              annotations:
                summary: "High CPU usage in pod"
                description: "Pod {{ $labels.pod }} CPU > 500m"

